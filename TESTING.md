# Thanos.grim Testing Guide

## Week 1-2 Testing Checklist

### Prerequisites

1. **Ollama Running**:
   ```bash
   # Start Ollama
   ollama serve

   # Pull codellama model
   ollama pull codellama:13b
   ```

2. **Grim Editor**:
   ```bash
   # Make sure Grim is built
   cd /data/projects/grim
   zig build
   ```

3. **Thanos.grim Plugin**:
   ```bash
   cd /data/projects/thanos.grim
   zig build

   # Copy plugin to Grim's plugin directory
   mkdir -p ~/.local/share/grim/plugins/thanos
   cp -r ./* ~/.local/share/grim/plugins/thanos/
   ```

---

## Test 1: Plugin Loading âœ…

**Goal**: Verify the plugin loads without errors

**Steps**:
1. Start Grim:
   ```bash
   cd /data/projects/grim
   ./zig-out/bin/grim
   ```

2. Check for loading message:
   - Should see: "Thanos AI plugin loaded âœ…"
   - Should see: "Available providers: Ollama, Claude, GPT-4, GitHub Copilot"

**Expected**:
- No errors in console
- Plugin loads successfully
- Status line updates

**Debug if failed**:
```bash
# Check plugin is in the right place
ls -la ~/.local/share/grim/plugins/thanos/

# Check logs
./zig-out/bin/grim 2>&1 | grep -i thanos
```

---

## Test 2: Hybrid Configuration Loading âœ…

**Goal**: Verify hybrid config is loaded correctly

**Steps**:
1. Create `~/.config/grim/thanos.toml`:
   ```toml
   [ai]
   mode = "hybrid"
   primary_provider = "ollama"

   [providers.ollama]
   enabled = true
   endpoint = "http://localhost:11434"
   model = "codellama:13b"

   [routing]
   fallback_chain = ["ollama"]
   ```

2. Start Grim
3. Run `:ThanosStats`

**Expected**:
- Popup shows: "Mode: hybrid"
- Shows: "Providers: 1"
- No config errors

**Debug**:
```bash
# Test config parsing manually
cd /data/projects/thanos
./zig-out/bin/thanos version  # Should work
./zig-out/bin/thanos discover  # Should show ollama
```

---

## Test 3: Provider Listing (`:ThanosProviders`) âœ…

**Goal**: Verify provider discovery works

**Steps**:
1. In Grim, run: `:ThanosProviders`

**Expected**:
- Popup opens with title "Thanos Providers"
- Shows: "ollama (available)" if Ollama is running
- Shows: "anthropic (unavailable)" if no API key set

**Debug**:
```bash
# Test provider discovery
cd /data/projects/thanos
./zig-out/bin/thanos discover
```

---

## Test 4: AI Completion (`:ThanosComplete`) ðŸ”¥

**Goal**: Actually generate AI code completion

**Steps**:
1. In Grim, open a Zig file:
   ```zig
   const std = @import("std");

   pub fn main() !void {
       // <cursor here>
   }
   ```

2. Position cursor after the comment
3. Run: `:ThanosComplete` or press `<leader>ak`

**Expected**:
- Shows: "ðŸ¤– Thanos: Generating completion..."
- Wait 2-5 seconds
- Code appears at cursor (e.g., `std.debug.print("Hello\\n", .{});`)
- Shows: "âœ… Completion generated by ollama"

**Debug if failed**:
```bash
# Test Thanos completion directly
cd /data/projects/thanos
echo "pub fn fibonacci" | ./zig-out/bin/thanos complete

# Check Ollama is responding
curl http://localhost:11434/api/generate -d '{
  "model": "codellama:13b",
  "prompt": "pub fn fibonacci",
  "stream": false
}'
```

---

## Test 5: Chat Window (`:ThanosChat`) âœ…

**Goal**: Verify chat window opens and works

**Steps**:
1. In Grim, run: `:ThanosChat` or press `<leader>ac`
2. Type: "How do I reverse a string in Zig?"
3. Press `<Enter>`

**Expected**:
- Split window opens (50% width)
- Shows: "# Thanos AI Chat"
- Your message appears
- AI response appears below (may take 3-10 seconds)

**Debug**:
- Check if window creation works: Try `:split` first
- Verify Ollama responds: `curl http://localhost:11434/api/chat ...`

---

## Test 6: Provider Switching (`:ThanosSwitch`) âœ…

**Goal**: Switch between providers

**Steps**:
1. Run: `:ThanosSwitch ollama`
2. Check status line - should show "AI: ollama"
3. Run: `:ThanosSwitch claude`
4. Check status line - should show "AI: claude"

**Expected**:
- Status line updates
- Shows: "Switched to [provider] âœ…"

---

## Test 7: Statistics (`:ThanosStats`) âœ…

**Goal**: View usage statistics

**Steps**:
1. After running a few completions
2. Run: `:ThanosStats`

**Expected**:
- Popup shows:
  - "Providers: N"
  - "Requests: N"
  - "Avg Latency: Nms"

---

## Test 8: Hybrid Mode Routing ðŸ”¥

**Goal**: Verify different tasks use different providers

**Steps**:
1. Set mode to "hybrid" in config
2. Enable both Ollama and Claude (with API key)
3. Run completion (should use Ollama - fast)
4. Run chat (should try Ollama first)
5. Run code review (should fallback to Claude if Ollama fails)

**Expected**:
- Fast tasks use Ollama
- Complex tasks fallback to cloud providers

---

## Test 9: Error Handling âœ…

**Goal**: Verify graceful error handling

**Steps**:
1. Stop Ollama: `killall ollama`
2. Try `:ThanosComplete`

**Expected**:
- Shows error message
- Falls back to next provider in chain
- Or shows: "No providers available"

---

## Test 10: Keybindings âœ…

**Goal**: Verify all keybindings work

| Key | Command | Expected |
|-----|---------|----------|
| `<leader>ac` | Open chat | Chat window opens |
| `<leader>ak` | Complete code | AI generates completion |
| `<leader>ap` | Switch provider | Prompt for provider name |
| `<leader>as` | Show stats | Stats popup |

---

## Performance Benchmarks

### Target Metrics

- **Plugin load time**: < 50ms
- **Completion latency** (Ollama): 500ms - 2s
- **Completion latency** (Claude): 1s - 3s
- **Memory usage**: < 10MB additional

### How to Measure

```bash
# Plugin load time
time ./zig-out/bin/grim --version

# Completion latency
# (Check timestamps in Grim status line)

# Memory usage
ps aux | grep grim
```

---

## Common Issues & Fixes

### Issue: "Thanos not initialized"
**Fix**:
1. Check thanos.toml exists
2. Check Ollama is running
3. Restart Grim

### Issue: "No providers available"
**Fix**:
1. Start Ollama: `ollama serve`
2. Pull model: `ollama pull codellama:13b`
3. Check config: `:ThanosProviders`

### Issue: Completion is slow
**Fix**:
1. Use smaller model: `codellama:7b` instead of `13b`
2. Switch to hybrid mode (uses local first)
3. Check network latency

### Issue: Plugin won't load
**Fix**:
1. Rebuild: `cd /data/projects/thanos.grim && zig build`
2. Check plugin path: `~/.local/share/grim/plugins/thanos/`
3. Check Grim logs: `./zig-out/bin/grim 2>&1 | grep ERROR`

---

## Next Steps After Week 1-2

Once basic tests pass:
- [ ] Add selection tracking
- [ ] Add diff view
- [ ] Add file refresh
- [ ] Test with multiple providers
- [ ] Benchmark performance
- [ ] Create demo video

---

## Success Criteria

Week 1-2 is complete when:
âœ… Plugin loads in Grim
âœ… Hybrid config works
âœ… `:ThanosComplete` generates code
âœ… `:ThanosChat` works
âœ… Provider switching works
âœ… All keybindings respond
âœ… Ollama integration works
âœ… Error handling is graceful
